GMaps.prototype.toImage=function(e){var e=e||{},r={};if(r.size=e.size||[this.el.clientWidth,this.el.clientHeight],r.lat=this.getCenter().lat(),r.lng=this.getCenter().lng(),this.markers.length>0){r.markers=[];for(var s=0;s<this.markers.length;s++)r.markers.push({lat:this.markers[s].getPosition().lat(),lng:this.markers[s].getPosition().lng()})}if(this.polylines.length>0){var t=this.polylines[0];r.polyline={},r.polyline.path=google.maps.geometry.encoding.encodePath(t.getPath()),r.polyline.strokeColor=t.strokeColor,r.polyline.strokeOpacity=t.strokeOpacity,r.polyline.strokeWeight=t.strokeWeight}return GMaps.staticMapURL(r)},GMaps.staticMapURL=function(e){function r(e,r){if("#"===e[0]&&(e=e.replace("#","0x"),r)){if(r=parseFloat(r),0===(r=Math.min(1,Math.max(r,0))))return"0x00000000";1===(r=(255*r).toString(16)).length&&(r+=r),e=e.slice(0,8)+r}return e}var s,t=[],o="http://maps.googleapis.com/maps/api/staticmap";e.url&&(o=e.url,delete e.url),o+="?";var l=e.markers;delete e.markers,!l&&e.marker&&(l=[e.marker],delete e.marker);var i=e.polyline;if(delete e.polyline,e.center)t.push("center="+e.center),delete e.center;else if(e.address)t.push("center="+e.address),delete e.address;else if(e.lat)t.push(["center=",e.lat,",",e.lng].join("")),delete e.lat,delete e.lng;else if(e.visible){var a=encodeURI(e.visible.join("|"));t.push("visible="+a)}var n=e.size;n?(n.join&&(n=n.join("x")),delete e.size):n="630x300",t.push("size="+n),e.zoom||(e.zoom=15);var p=!e.hasOwnProperty("sensor")||!!e.sensor;delete e.sensor,t.push("sensor="+p);for(var h in e)e.hasOwnProperty(h)&&t.push(h+"="+e[h]);if(l)for(var c,g,u=0;s=l[u];u++)c=[],s.size&&"normal"!==s.size?c.push("size:"+s.size):s.icon&&c.push("icon:"+encodeURI(s.icon)),s.color&&c.push("color:"+s.color.replace("#","0x")),s.label&&c.push("label:"+s.label[0].toUpperCase()),g=s.address?s.address:s.lat+","+s.lng,c.length||0===u?(c.push(g),c=c.join("|"),t.push("markers="+encodeURI(c))):(c=t.pop()+encodeURI("|"+g),t.push(c));if(i){if(s=i,i=[],s.strokeWeight&&i.push("weight:"+parseInt(s.strokeWeight,10)),s.strokeColor){var d=r(s.strokeColor,s.strokeOpacity);i.push("color:"+d)}if(s.fillColor){var f=r(s.fillColor,s.fillOpacity);i.push("fillcolor:"+f)}var m=s.path;if(m.join)for(var k,v=0;k=m[v];v++)i.push(k.join(","));else i.push("enc:"+m);i=i.join("|"),t.push("path="+encodeURI(i))}return t=t.join("&"),o+t};